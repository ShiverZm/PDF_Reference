# 3.4.5 增量更新

PDF文件的内容可以增量更新，而不需要重写整个文件。更改被附加到文件的末尾，保持其原始内容不变。以这种方式更新文件(如2.2.7节“增量更新”所述)的主要优点是，对大文档的小更改可以快速保存。还有其他优势:

* 在某些情况下，增量更新是保存对文档的更改的唯一方法。在保存文档时最小化数据丢失风险的一种公认做法是将其写入新文件并重命名新文件以替换旧文件。然而，在某些上下文中，例如当跨HTTP连接编辑文档或使用OLE嵌入(特定于windows的技术)时，不能以这种方式覆盖原始文件的内容。增量更新可用于保存在这些上下文中对文档的更改。
* 一旦签署了文档（请参见第2.2.6节，“安全”），则必须使用增量更新保存对文档所做的所有更改，因为更改文件中的任何现有字节都会使现有签名无效。

在增量更新中，任何新的或更改的对象都会被添加到文件中，添加一个交叉引用部分，并插入一个新的尾部。结果文件的结构如图3.3所示。“更新文件的完整示例”见“Updating Example”。

更新文件时添加的交叉引用部分仅包含已更改、替换或删除的对象的条目。已删除的对象在文件中保持不变，但通过它们的交叉引用条目标记为已删除。添加的尾部包含了之前尾部中的所有条目（可能是修改过的），以及给出前面交叉参考部分位置的Prev条目（见第97页的表3.13）。如图3.3所示，已更新多次的文件包含多个尾部；每个尾部由自己的文件结束(%%EOF)标记终止。

由于更新被附加到PDF文件中，因此一个文件可以具有具有相同对象标识符（对象编号和生成号）的对象的几个副本。例如，如果一个文本注释（见第8.4节，“注释”）被更改多次，并且在更改之间保存文件，则可能会发生这种情况。因为没有删除文本注释对象，所以它保留了与以前相同的对象编号和生成编号。对象的更新副本包含在添加到文件中的新更新部分中。更新的交叉引用部分包括对对象的这个新副本的字节偏移量，覆盖了原始交叉引用部分中包含的旧字节偏移量。当消费者应用程序读取该文件时，它必须构建其交叉引用信息，使每个对象的最新副本是在文件中访问的交叉引用信息。

在1.4之前的PDF版本中，不可能使用增量更新来更改文档符合的PDF版本，因为该版本仅在文件开头的头中指定（参见第3.4.1节“文件头”）。在PDF1.4中，文档目录字典中的版本条目（见第3.6.1节，“文档目录”）可以覆盖标头中指定的版本，从而允许通过增量更新更改版本。



![一个增量更新的pdf文件结构](<../../.gitbook/assets/image (11).png>)

