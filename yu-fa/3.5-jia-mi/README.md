# 3.5 加密

可以对PDF文档进行加密(PDF 1.1)，以保护其内容不受未经授权的访问。加密适用于文档的PDF文件中的所有字符串和流，但不适用于其他对象类型，如整数和布尔值，它们主要用于传递关于文档结构的信息，而不是它的内容。不加密这些值允许对文档中的对象进行随机访问，而加密字符串和流则保护文档的实质性内容。

注:当一个PDF流对象(见第3.2.7节，“流对象”)引用一个外部文件时，流的内容不会被加密，因为它们不是PDF文件本身的一部分。但是，如果流的内容被嵌入到PDF文件中(见3.10.3“嵌入文件流”)，它们就会像文件中的其他流一样被加密。从PDF 1.5开始，嵌入的文件可能会被加密到一个未加密的文档中(见3.5.4节，“Crypt过滤器”)

与加密相关的信息存储在文档的加密字典中，该字典是文档的预告字典中的Encrypt条目的值(参见第97页的表3.13)。拖车字典中没有这个条目意味着文档没有加密。表3.18中所示的条目是所有加密词典所共有的。

\
加密字典的Filter条目标识文件的安全处理程序，这是一个实现加密过程的各个方面并控制对加密文档内容的访问的软件模块。PDF指定了一个标准的基于密码的安全处理程序，所有使用者应用程序都希望支持它，但是应用程序可以选择提供它们自己的安全处理程序。

SubFilter条目指定加密字典内容的语法。它允许处理程序之间的互操作性;也就是说，如果文档都支持SubFilter指定的格式，那么文档可以由非首选处理程序(Filter条目)解密。

V条目在指定使用哪种算法时，决定了加密密钥的长度，PDF文件中的数据的加密(和解密)基于此密钥。对于V值2和3,Length条目指定加密密钥的确切长度。在PDF 1.5中，V的值为4允许安全处理程序使用自己的加密和解密算法，并指定在特定流上使用的crypt过滤器(见3.5.4节“crypt过滤器”)。

加密字典的其余内容由安全处理程序决定，并且可能因处理程序的不同而不同。标准安全处理程序的条目在3.5.2节“标准安全处理程序”中描述。公开密钥安全处理程序的条目在第3.5.3节“公开密钥安全处理程序”中描述。

表 3.18 所有加密字典的公共条目

| KEY       | TYPE       | VALUE                                                                                                                                                                                                                                                                                                              |
| --------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Filter    | name       | （必填项）此文档的首选安全处理程序的名称。通常，它是用于加密文档的安全处理程序的名称。如果不存在子过滤器，则在打开文档时只能使用此安全处理程序。如果存在，消费者应用程序可以使用实现子过滤器指定的格式的任何安全处理程序。标准处理程序是内置的基于密码的安全处理程序的名称。其他安全处理程序的名称可以使用附录e中描述的程序进行注册。注意：自本文档的以前版本以来，此条目的定义已被澄清。                                                                                                                      |
| SubFilter | name       | (可选；PDF1.3)完全指定加密字典内容的格式和解释的名称。需要允许除过滤器指定的安全处理程序以外的安全处理程序来解密文档。如果没有此条目，则不应允许其他安全处理程序解密该文档。注：此条目在PDF1.3中引入，以支持在PDF文件中使用公钥密码学（参见第3.5.3节“公钥安全处理程序”）；但是，它直到第四版（PDF1.5）才纳入PDF参考中。                                                                                                                                       |
| V         | number     | <p>（可选，但强烈推荐）指定用于加密和解密文档的算法的代码：</p><ul><li>0 未记录文档且不再支持，强烈禁止使用的算法。119页算法3.1，加密密钥长度为 40位，见下文。</li><li>2 (PDF1.4)算法3.1，但允许加密密钥长度大于40位。</li><li>3(PDF1. 4 )一种未公开的算法，允许加密密钥长度从40到128位；参见附录H. </li><li>4 (PDF1.5)中的实现说明22。安全处理程序使用CF、StmF和StrF条目指定的规则定义文档中加密和解密的使用。如果省略此条目，则默认值为0，但强烈建议该值为1或更大。（见附录H中的实施说明23）</li></ul> |
| Length    | integer    | (可选;PDF 1.4;仅当V为2或3时)加密密钥的长度，以比特为单位。取值为8的整数倍，取值范围为40 \~ 128。默认值:40。                                                                                                                                                                                                                                                |
| CF        | dictionary | <p><br>(可选;只有当V的值为4时才有意义;一个字典，它的键是crypt过滤器名称，值是相应的crypt过滤器字典(见表3.22)。除了标准的crypt过滤器名称(见表3.23)外，文档中使用的每个crypt过滤器都必须在这个字典中有一个条目。</p><p>注意：尝试重新定义表3.23中的任何标准名称都将被忽略。</p>                                                                                                                                               |
| StmF      | name       | （可选；只有当V的值为4时才有意义；PDF1.5）解密流时默认使用的隐窝过滤器的名称。该名称必须是CF字典中的密钥或表3.23中指定的标准隐窝筛选器名称。文档中除交叉引用流（请参阅第3.4.7节“交叉引用流”）或过滤器阵组中具有加密条目的流（参见表3.5）外，安全处理程序使用此加密过滤器进行解密。默认值：**Identity**.                                                                                                                                             |
| StrF      | name       | （可选；只有当V的值为4时才有意义；PDF1.5）解密文档中所有字符串时使用的隐窝过滤器的名称。该名称必须是CF字典中的密钥或表3.23中指定的标准隐窝筛选器名称。默认值：**Identity**.                                                                                                                                                                                                                |
| EFF       | name       | （可选；只有当V值为4时才有意义；PDF1.6）加密嵌入文件流时默认使用的加密过滤器的名称；它必须对应于CF字典中的密钥或表3.23中指定的标准加密过滤器名称。此条目由安全处理程序提供。(参见附录H中的实现说明24)应用程序在加密嵌入式文件时应尊重此值，但嵌入式具有自己的加密过滤器说明符的文件流除外。如果此条目不存在，并且嵌入的文件流不包含加密筛选器指定符，则应使用StmF指定的默认流加密筛选器对该流进行加密。                                                                                                    |

与文档主体中的字符串不同，加密字典中的字符串必须是直接对象。加密字典的内容没有被通常的方法加密(由V条目指定的算法)。安全处理程序负责加密它们需要保护的加密字典中的任何数据。

\
注:如果PDF提供的加密方法和语法不足以满足需求，文档创建者有两种选择:他们可以提供替代的安全处理程序，或者他们可以自己加密整个PDF文档，而不使用PDF安全性。
