# 8.6.3.4 签名域（Signature Fields ）

签名域（PDF 1.3）是包含数字签名的表单域（请参见“Digital Signature”）。 表示签名域的域字典在表1中列出的附加条目。域类型（FT）应为Sig，域值（V）（如果存在）是签名字典，是包含签名和相关的各种属性。

填写（签名）签名域需要至少更新V条目，并且通常还更新相关联的 widget 注释的AP条目。 导出签名域通常会导出T，V和AP条目。

与其他域一样，签名域可以由widget注释字典来描述。 这种字典中的注释矩形（Rect）给出了其页面上的位置。 如果不打算显示的签名域，可以将注释矩形的高度和宽度设置为零。 如果F条目的Hidden位或NoView位为真，则签名为不可见。

签名域的widget注释的外观字典（AP），定义了签名域在页面上的可视外观。

**表8.81 特定于签名域的附加条目**

| Key  | Type       | Value                                                               |
| ---- | ---------- | ------------------------------------------------------------------- |
| Type | name       | （可选;应为间接引用; PDF 1.5）签名域锁定字典，指定在签名此签名域时，应锁定的一组表单域。 表8.82 列出了此词典中的条目。 |
| SV   | dictionary | （可选;应为间接引用; PDF 1.5）种子值字典（参见表3），包含约束应用于此域的签名属性的信息。                  |

签名域字典中的SV条目的值是种子值字典，提供将在应用签名时使用的约束信息。 其Ff条目指定是否应尊重字典中的其他条目或仅仅是推荐。

_注意:种子值字典可以包含属于多个处理程序的私有条目的种子值。给定的处理程序应该只使用与自身相关的条目，而忽略其他条目。_

__

**表8.82 签名域锁字典（Signature Field Lock Dictionary）中的条目**

| Key    | Type  | Value                                                                                            |
| ------ | ----- | ------------------------------------------------------------------------------------------------ |
| Type   | name  | （可选）如果存在，则应为SigFieldLock。                                                                        |
| Action | name  | （必选）与Fields一起表示应锁定的域集的名称。 值应为以下之一：All：文档中的所有域；Include：Fields中指定的所有域；Exclude：除“Fields”中指定的域外的所有域。 |
| Fields | array | （如果Action的值为Include或Exclude，则为必需）包含域名称的文本字符串数组。                                                  |

**表8.83签名域种子值字典(Signature Field Seed Value Dictionary)中的条目**

| Key              | Type       | Value                                                                                                                                                                                                                                               |
| ---------------- | ---------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Type             | name       | （可选）如果存在，则应为SV。                                                                                                                                                                                                                                     |
| Ff               | integer    | （可选）一组位标志，指定此字典中特定条目的解释。 标志的值为1表示关联的条目是必需的约束。 值0表示关联的条目是可选约束。 bit 位置为1（Filter）; 2（SubFilter）; 3（V）; 4（Reasons）; 5（LegalAttestation）; 6（AddRevInfo）;和7（DigestMethod）。 默认值：0。                                                                         |
| Filter           | name       | （可选）用于签名的签名处理程序。 从PDF 1.7开始，如果指定了Filter，并且Ff条目指示此条目是必需的约束，则在签名时应使用此条目指定的签名处理程序; 否则，不得签名。 如果Ff指示这是可选约束，则可以使用此处理程序（如果可用）。 如果它不可用，则可以使用不同的处理程序。                                                                                                        |
| SubFilter        | array      | （可选）一个名称数组，指示签名时要使用的编码。数组中与签名处理程序支持的编码匹配的第一个名称应该是实际用于签名的编码。如果指定了SubFilter并且Ff条目指示此条目是必需的约束，则在签名时应使用第一个匹配的编码; 否则，不得签字。 如果Ff表明这是一个可选约束，那么如果可用，则应使用第一个匹配编码。 如果没有，则可以使用不同的编码。                                                                           |
| DigestMethod     | array      | （可选; PDF 1.7）一个名称数组，表示签名时可使用的摘要算法。 该值应为SHA1，SHA256，SHA384，SHA512和RIPEMD160之一。 默认值是implementation-specific。此属性仅在数字凭证签名包含RSA公钥/私钥时适用。 如果它包含DSA公钥/私钥，则摘要算法始终为SHA1，并且应忽略此属性。                                                                            |
| V                | real       | （可选）签名域种子值字典解析器所需的最低能力。 值为1表示：解析器应能够识别PDF 1.5文件中的所有种子值字典条目。 值为2表示：应能够识别指定的所有种子值字典条目.Ff条目指示是否将其视为必需约束。                                                                                                                                               |
| Cert             | dictionary | （可选）证书种子值字典（参见表4），其中包含有关签名时，应使用的证书特征的信息。                                                                                                                                                                                                            |
| Reasons          | array      | （可选）一个文本字符串数组，用于指定签署文档的可能原因。 如果指定，则此条目中提供的原因将替换合格产品使用的原因。如果提供了Reasons数组，并且Ff条目指示Reasons是必需的约束，则数组中的一个原因应该用于签名字典; 否则，不得签字。 如果Ff条目指示Reasons是可选约束，则可以选择阵列中的一个原因或者可以提供自定义原因。如果省略Reasons数组或数组中只有一个句号(2Eh)字符串，并且Ff条目指示Reasons是必需约束，则应签名字典中的Reason条目应该被忽略。 |
| MDP              | dictionary | （可选; PDF 1.6）只包含单个条目的字典，其键为P，其值为0到3之间的整数。值 0 将签名定义为作者签名（请参见“数字签名”）。 值1到3应用于认证签名，并对应于DocMDP转换参数字典中的P值。如果此MDP密钥不存在，或MDP字典不包含P条目，则不应定义关于签名类型或其权限的规则。                                                                                                   |
| TimeStamp        | dictionary | （可选; PDF 1.6）包含两个条目的时间戳字典：URL：一个ASCII字符串，指定时间戳服务器的URL，提供符合RFC 3161，Internet X.509公钥基础结构时间戳协议的时间戳。Ff：一个整数，其值为1（签名应具有时间戳）或0（签名不需要时间戳）。 默认值：0。                                                                                                         |
| LegalAttestation | array      | （可选; PDF 1.6）一个法律证明的文本字符串数组（参见“法律内容证明”）。 Ff条目中相应标志的值指示这是否是必需约束。                                                                                                                                                                                     |
| AddRevInfo       | boolean    | （可选; PDF 1.7）表示是否应进行撤销检查的标志。默认值：false                                                                                                                                                                                                               |

对于不存在的可选键，在签名时不应对该属性的签名处理程序施加约束。



**表8.84 证书种子值字典(Certificate Seed Value Dictionary)中的条目**

| Key       | Type                   | Value                                                                                                                                          |
| --------- | ---------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| SubjectDN | array of dictionaries  | （可选; PDF 1.7）一个字典数组，每个字典都指定一个主题专有名称（DN），该名称应出现在证书中，以便签名可以接受。Ff条目中相应标志的值指示此条目是否是必需约束。                                                           |
| KeyUsage  | array of ASCII strings | （可选; PDF 1.7）ASCII字符串数组，其中每个字符串指定一个可接受的密钥用法扩展，该扩展应出现在签名证书中。多个字符串指定一系列可接受的密钥用法扩展。 RFC 3280中描述了密钥用法扩展。详情下面有描述。                                   |
| Issuer    | array                  | （可选）一个字节字符串数组，包含可接受发行者证书（DER-encoded X.509v3）。 如果签名者的证书指定任意的发行人（直接或间接），则该证书应被视为可接受签字。 Ff条目中相应标志的值指示这是否是必需约束。 此数组可能包含自签名证书。                     |
| OID       | array                  | （可选）一个包含证书策略的对象标识符（OID）的字节字符串数组，该证书策略应出现在签名证书中。例：（2.16.840.1.113733.1.7.1.1）。仅当Issuer的值不为空时才使用此域。 RFC 3280中描述了证书策略扩展。 Ff条目中相应标志的值指示这是否是必需约束。   |
| URL       | ASCII string           | （可选）URL，其用途应由URLType条目定义。                                                                                                                      |
| URLType   | name                   | （可选; PDF 1.7）表示URL条目用法的名称。以下值指定有效的标准用法：1、Browser - URL引用应在Web浏览器中显示的内容，以便在未找到匹配的凭据时注册新凭据。 对于此用法，应忽略Ff属性的URL位；2、第三方可以使用自己的属性值扩展此属性。默认值为Browser。 |

#### KeyUsage

（可选; PDF 1.7）ASCII字符串数组，其中每个字符串指定一个可接受的密钥用法扩展，该扩展应出现在签名证书中。多个字符串指定一系列可接受的密钥用法扩展。 RFC 3280中描述了密钥用法扩展。\
字符串中的每个字符表示密钥用法类型，其中字符的顺序表示它表示的密钥用法扩展。以下字符串中的第一个到第九个字符（从左到右）表示“键 - 用法扩展”所需的值：\


1. digitalSignature
2. non-Repudiation
3. &#x20;keyEncipherment
4. dataEncipherment
5. &#x20;keyAgreement
6. &#x20;keyCertSign
7. &#x20;cRLSign
8. &#x20;encipherOnly
9. &#x20;decipherOnly

任何缺少或非下列值之一的字符都应视为“X”：\
0-不应设置相应的密钥用法。\
1-应设置相应的密钥用法。\
X-相应密钥用法的状态无关紧要。\
示例1：字符串值“1”和“1XXXXXXXX”表示设置密钥用法类型digitalSignature，并且所有其他密钥用法类型的状态无关紧要的设置。\
Ff条目中相应标志的值指示这是否是必需约束。
