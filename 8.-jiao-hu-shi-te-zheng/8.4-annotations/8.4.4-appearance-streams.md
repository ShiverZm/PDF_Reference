---
description: 未完...
---

# 8.4.4 外观流 (Appearance Streams)

从PDF 1.2开始，注释可以指定一个或多个外观流，作为早期版本中提供的简单边框和颜色特征的替代。外观流允许以不同的方式直观地显示注释，以反映其与用户的交互。每个外观流都是一个表单XObject(见第4.9节“form XObjects”):一个在标注矩形内呈现的自包含内容流。

\
以下方法用于从外观XObject的坐标系统映射到默认用户空间中的注释矩形(由其Matrix条目定义;参见表4.45):

**算法 8.1**

1. 使用Matrix转换外观的边界框(由其BBox条目指定)，以生成任意方向的四边形。转换后的外观框是包含这个四边形的最小的直立矩形。
2. 计算一个矩阵A，它缩放并转换转换后的外观框，使其与注释的矩形(由Rect条目指定)的边缘对齐。A将转换后的外观框的左下角(x和y坐标最小的角落)和右上角(x和y坐标最大的角落)映射到注释矩形的相应角落。
3. &#x20;**** 矩阵与A连接，形成一个矩阵AA，从外观的坐标系统映射到默认用户空间中的注释矩形:  **AA = A × Matrix**

如果使用NoZoom或NoRotate标志被设置(参见章节8.4.2，“Annotation Flags”)。任何转换应用于整个注释的同时也应用于其中的外观。在PDF 1.4中，注释的外观可以包括透明性。如果外观的流字典不包含Group条目，则将其视为非隔离的、非击倒透明性组。否则，使用组字典中指定的孤立值和敲除值(参见第7.5.5节，“透明组XObjects”)。

透明度组是由页面内容和之前绘制的注释组成的背景组成的，使用的混合模式为Normal, alpha常量为1.0，软蒙版为None。(见附录H 的实施说明87)&#x20;

注意:如果在不使用外观流绘制的注释上绘制透明的注释外观，其效果依赖于实现。这是因为这些注释有时是通过不符合Adobe成像模型的方法绘制的。此外，突出显示透明注释外观的效果取决于实现。

**注释最多可以定义三个单独的外观:**

* 当注释不与用户交互时使用正常的外观。此外观还用于打印注释。（Normal）
* 当用户在不按鼠标按钮的情况下将光标移动到注释的活动区域时，将使用翻转外观。(Reverse)
* 当在注释的活动区域内按下或按下鼠标按钮时，将使用下拉外观。(Down)

正如这里所使用的，术语鼠标表示一种通用的指向设备，它控制屏幕上光标的位置，并且至少有一个可以按下、按下和释放的按钮。关于进一步的讨论，请参见8.5.2节“触发事件“。



**表8.19 外观字典的条目**

| KEY | TYPE                 | VALUE                           |
| --- | -------------------- | ------------------------------- |
| N   | stream or dictionary | (必选)注释的正常(Normal)外观。            |
| R   | stream or dictionary | (可选)注释的翻转(Reverse)外观。缺省值:N表项的值。 |
| D   | stream or dictionary | (可选)注释的下拉（Down）外观。缺省值:N表项的值。    |

外观字典中的每个条目可以包含单个外观流或外观子字典。在后一种情况下，子字典定义了多个外观流，对应于注释的不同外观状态。

例如，表示交互式复选框的注释可能有两个外观状态:On和Off。它的外观字典可以定义为：

```
/AP << /N << /On formXObject1
/Off formXObject2
 >>
/D << /On formXObject3
/Off formXObject4
 >>
 >>
```

其中，formXObject1和formXObject2定义复选框在选中和未选中状态下的正常外观，formXObject3和formXObject4提供视觉反馈，例如当用户单击它时增强其轮廓。(没有定义R项，因为当用户将光标移到复选框上而不按鼠标按钮时，不需要特殊的外观。)

在已检查和未检查的外观状态之间的选择由注释字典中的AS条目决定(参见606页的表8.15)。

注意:一些标准PDF注释类型，比如电影注释—以及所有由第三方定义的自定义注释类型—都是通过插件扩展实现的。如果特定注释类型的插件不可用，那么PDF查看器应用程序应该以正常的(N)外观显示注释。如果注释的as条目指定了在外观字典中没有定义外观的外观状态，查看器应用程序还应该尝试提供合理的行为(比如什么都不显示)。

为了方便管理重复使用的外观流，PDF文档的名称字典(见3.6.3节，“Name Dictionary”)中的AP entry可以包含一个名称树，将名称字符串映射到外观流。名称字符串没有标准含义;没有PDF对象按名称引用外观流。
