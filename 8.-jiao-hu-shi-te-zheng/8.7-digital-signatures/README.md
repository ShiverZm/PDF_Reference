---
description: 介绍数字签名（Digital Signatures）/摘要（Digest）
---

# 8.7 数字签名

**数字签名(PDF 1.3)**可用于_验证用户的身份和文档内容_。它存储有关签名者的信息以及签署时文档的状态。签名可以是纯粹的数学形式，如公开/私钥加密的文档摘要，也可以是生物识别形式的身份识别，如手写签名、指纹或视网膜扫描。使用的特定形式的身份验证是由插件签名处理程序实现的。鼓励第三方处理程序编写者向Adobe注册其处理程序名称;请参阅附录E。

签名信息包含在签名字典中，签名字典表项如表8.102所示。签名处理程序可以使用或省略表中标记为可选的条目，但如果要使用它们，则鼓励以标准方式使用它们。此外，签名处理程序可以添加它们自己的私有条目。为了避免名称重复，建议所有此类私有条目的键都以已注册的处理程序名称为前缀，后面加一个句点(。)．

签名是通过计算文档中数据(或部分数据)的摘要并将摘要存储在文档中来创建的。为了验证签名，将重新计算摘要并与存储在文档中的摘要进行比较。摘要值的差异表明自签署文档以来是否已经进行了修改。

有两种已定义的技术可以计算PDF文件全部或部分内容的可重复摘要：

* 字节范围摘要是根据文件中的字节范围计算的，该范围由签名字典中的ByteRange条目表示。这个范围通常是整个文件，包括签名字典，但不包括签名值本身(Contents条目)。当出现字节范围摘要时，签名字典中的所有值都必须是直接对象。参见附录H中的实现说明139。
* 对象摘要(PDF 1.5)是通过有选择地遍历内存中对象的子树来计算的，从引用的对象开始，该对象通常是根对象。生成的摘要以及关于如何计算的信息被放置在签名参考字典中，表8.103列出了该字典的条目。TransformMethod条目指定用于计算摘要的通用方法，TransformParams条目指定计算的可变部分。在8.7.1节“变换方法”中详细描述了变换方法。

一个PDF文档可能包含以下标准的数字签名类型：

* **文档签名（document (or ordinary) signatures）/批准签名/签名域签名**，可能有**一个或多个**。这些签名出现在**签名表域（signature form fields）**(具体查看695页 “Signature Fields”)。每个签名对应的签名字典（Signature Dictionary）都是表单字段的值（正如其V条目特定的)，如上所述，签名字典必须包含一个表示字节范围摘要的ByteRange条目。注:如果一份已签名的文档通过增量更新的方式进行修改和保存(见3.4.5节“增量更新”)，则字节范围对应的数据保留原始签名。因此，如果签名是有效的，就有可能重新创建签名时存在的文档状态。
* **证书签名（PDF 1.5）（Author or Certificate Signature）/作者证书签名**，该MDP(modification detection and prevention)类型签名最多只允许存在**一个**。 证书签名的签名字典应为签名域的值，并应包含ByteRange条目。 它也可以从权限字典（见“权限字典”）中的DocMDP条目引用。 签名字典应包含具有DocMDP转换方法的签名引用字典。 有关如何创建和验证这些签名的信息，请参见“DocMDP”。用于证书或批准签名的签名字典还可以带有FieldMDP变换方法的签名参考字典; 见“FieldMDP”。
* **使用权签名(**usage rights signatures**)，**最多存在**两个。**其签名字典应从权限字典中的UR3（PDF 1.6）条目引用。 签名字典应包含一个Reference条目，其值是具有UR变换方法的签名引用字典。有关如何创建和验证这些签名的信息，请参见“UR”。
* 在FDF文件中Sig条目特指一个签名字典。

表 8.102 签名字典中的条目

| Key            | Type                 | Value                                                                                                                                                                                                                                          |
| -------------- | -------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Type           | name                 | （可选）如果存在，则应为Sig。                                                                                                                                                                                                                               |
| Filter         | name                 | （必填；可继承）当验证这个数字签名时，优先选用该类型名称的签名处理器。如果PropBuild条目不存在，则该条目类型名的签名处理器可用于创建数字签名。如果Prop\_build条目存在，它可以用来确定处理程序的名称，创建签名(通常与Filter相同，但不是必需的)应用程序在验证签名时可以替换不同的处理器，只要它支持指定的SubFilter格式。典型的签名处理器包括，Adobe的PPKLite,Entrust的PPKEF，CICI的Signit和Versign.PPKVS。 |
| SubFilter      | name                 | （可选）描述签名值和密钥信息使用编码的名称。 （PDF 1.6）应使用以下公钥加密签名值：adbe.x509.rsa\_sha1，adbe.pkcs7.detached和adbe.pkcs7. sha1。                                                                                                                                         |
| Contents       | byte string          | （必填）签名值。 当存在ByteRange时，该值应为十六进制字符串，表示字节范围摘要的值。 对于公钥签名，Contents应该是DER编码的PKCS＃1二进制数据对象或DER编码的PKCS＃7二进制数据对象。 必须在计算消息摘要之前，分配Contents值的空间。                                                                                                          |
| Cert           | array or byte string | （当SubFilter为adbe.x509.rsa\_sha1时为必需）字节字符串数组，表示签署和验证使用公钥加密的签名时，使用的X.509证书链，如果证书链只有一个条目，则表示字节串。 签名证书应在数组中第一个元素，该证书用于验证内容中的签名值，其他证书用于验证签名证书的真实性。 如果SubFilter是adbe.pkcs7.detached或adbe.pkcs7.sha1，则不应使用此条目，并且证书链应放在Contents中的PKCS＃7信封中。            |
| ByteRange      | array                | （必填）一组整数对（起始字节偏移量，字节长度），它将描述摘要计算的确切字节范围。 应使用多个不连续的字节范围来描述不包含签名值（内容条目）的字节范围。                                                                                                                                                                    |
| Reference      | array                | （可选; PDF 1.5）一组签名参考词典。                                                                                                                                                                                                                         |
| Changes        | array                | （可选）一个包含三个整数的数组，用于指定在先前签名和此签名之间对文档所做的更改：更改的页数、更改的域数量以及被填写的域数量。签名的顺序应由ByteRange的值决定。 由于每个签名都会导致增量保存，因此以后的签名具有更大的长度值。                                                                                                                            |
| Name           | text string          | （可选）签署文档的人员或机构的名称。 仅当无法从签名中提取名称时，才应使用此值。                                                                                                                                                                                                       |
| M              | date                 | （可选）签署时间。 根据签名处理程序，该值可能是正常的未验证计算机时间，或者是从安全时间服务器生成的可验证的时间。 仅当签名中签署时间不可用时，才应使用此值。                                                                                                                                                                |
| Location       | text string          | （可选）签名使用的CPU主机名或物理位置。                                                                                                                                                                                                                          |
| Reason         | text string          | （可选）签署的原因，例如（我同意…）。                                                                                                                                                                                                                            |
| ContactInfo    | text string          | （可选）签名者提供的联系方式，以使收件人能够联系签名者以验证签名。比如：电话号码。                                                                                                                                                                                                      |
| R              | integer              | （可选）用于创建签名的签名处理程序的版本。 （PDF 1.5）不得使用此条目，并且该信息应存储在Prop\_Build字典中。                                                                                                                                                                                |
| V              | integer              | （可选; PDF 1.5）签名字典格式的版本。 如果Reference字典被认为对签名的验证至关重要，则该值为1。 默认值：0。                                                                                                                                                                               |
| Prop\_Build    | dictionary           | （可选; PDF 1.5）记录签名的计算机环境状态的信息的字典，例如：创建签名的处理程序的名称，软件构建日期，版本， 和PDF操作系统.PDF签名构建字典规范，提供了使用该字典的实现指南。                                                                                                                                                 |
| Prop\_AuthTime | integer              | （可选的；PDF 1.5）签名者最后认证后的秒数。如果值未知，则应省略。                                                                                                                                                                                                           |
| Prop\_AuthType | name                 | （可选; PDF 1.5）用于对签名者进行身份验证的方法。 有效值应为PIN，Password和Fingerprint。                                                                                                                                                                                   |

表8.103 签名参考字典(signature reference dictionary)中的条目

| Key             | Type       | Value                                                                                                                                                                     |
| --------------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Type            | name       | （可选）如果存在，则应为SigRef。                                                                                                                                                       |
| TransformMethod | name       | （必需）转换方法的名称（请参见“转换方法”）。 有效值应为：DocMDP：用于检测文档相对于由文档创建者签名的签名字段的修改; 见“DocMDP”。UR：用于检测文档的修改，这些修改会使启用权限的文档中的签名无效; 见“UR。”FieldMDP：用于检测对TransformParams中指定的表单域列表的修改; 见“FieldMDP”。 |
| TransformParams | dictionary | （可选）一个字典，指定TransformMethod指定的变换方法的变换参数（变量数据）。 每个方法都有自己的一组参数。                                                                                                              |
| Data            | (various)  | （当TransformMethod为FieldMDP时为必需）执行对象修改分析的间接引用对象。 对于FieldMDP以外的变换方法，隐式定义此对象。                                                                                                |
| DigestMethod    | name       | （可选;需要PDF 1.5）标识计算摘要时使用的算法名称。 有效值为MD5和SHA1。 默认值：MD5。                                                                                                                      |

