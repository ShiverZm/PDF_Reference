# 8.5.2 触发事件

&#x20;当你打开或关闭PDF文档中的页面时，Adobo Acrobat 会引发一些“事件”，可以激活电影，播放声音甚至运行Javascript代码，这个就被称之为触发事件 (**Trigger Events**)。

一个 注释（annotations）、页面对象(page object)或者交互式表格域（interactive form field;PDF1.3）都包含一个名为AA 的条目，这个条目可以指定一个 附加动作字典（additional-actions dictionary；PDF1.2），而这个附加动作字典拓展了能触发动作执行的事件集合。

在PDF 1.4中，文档目录字典(见3.6.1节，“Document Catalog Dictionary") 也可能包含一个AA条目，用于触发影响整个文档的事件。表8.44到8.47显示了这种类型的字典的内容。(见附录H的附注98及99)

PDF 1.5介绍了四个触发器事件来支持多媒体演示:

* **PO**和**PC** 条目具有与页面对象的附加操作字典中的**O**和**C**条目类似的功能（见下表）。 但是，这些带有注释的触发器允许注释对象是自包含的，极大地简化了创作。例如，包含此类操作的注释可以在页面之间复制或移动，而不需要要求页面打开/关闭等被改变的动作。
* **PV和PI**条目的区别在于打开的页面和可见的页面。在任何时候，在查看器应用中，只有一个页面时才能被认为是打开的，而多个页面时是可见的，主要取决于页面布局。

&#x20;注：对于这些触发事件来说，注释中 **F** 指定的标志，对一个给定的触发事件是否发生无关。



以下翻译“操作”同本节动作含义

表 8.44 注释的附加动作(aditional-action)字典条目列表

| Key | Type       | Value                                                                                                                                    |
| --- | ---------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| E   | dictionary | （可选; PDF 1.2）当光标进入注释的活动区域时应执行的一个动作。**(Enter)**                                                                                           |
| X   | dictionary | （可选; PDF 1.2）当光标退出注释的活动区域时应执行的一个动作。**(Exit)**                                                                                            |
| D   | dictionary | （可选; PDF 1.2）在注释的活动区域内按下鼠标按钮时应执行的一个动作。**(Down)**                                                                                         |
| U   | dictionary | （可选; PDF 1.2）在注释的活动区域内释放鼠标按钮时应执行的一个动作。为了向后兼容，注释字典中的A条目（如果存在）优先于此条目。**(Up)**                                                              |
| Fo  | dictionary | （可选; PDF 1.2;仅限 widget 窗口小部件注释）注释接收输入焦点时应执行的一个动作。**(Focus)**                                                                             |
| Bl  | dictionary | （可选; PDF 1.2;仅限 widget 小部件注释）（大写B，小写L）当注释失去输入焦点时应执行的一个动作。**(Blur)**                                                                      |
| PO  | dictionary | （可选; PDF 1.5）打开包含注释的页面时应执行的操作。比如：当用户从下一页或上一页导航到它时，或者通过链接注释或大纲项导航到它。如果存在此类操作，则应在页面的附加操作字典中的O操作和文档目录中的OpenAction条目之后执行的一个动作。**(PageOpen)** |
| PC  | dictionary | （可选; PDF 1.5）关闭包含注释的页面时应执行的一个动作。比如：当用户导航到下一页或上一页时，或者跟随链接注释或大纲项时。如果存在，该操作应在页面的附加操作字典中的C操作之前执行。**(PageClose)**                             |
| PV  | dictionary | （可选; PDF 1.5）当包含注释的页面变为可见时应执行的一个动作。**(PageVisible)**                                                                                     |
| PI  | dictionary | （可选; PDF 1.5）当浏览器界面中不再显示包含注释的页面时，应执行的一个动作。**(PageInvisible)**                                                                            |





表 8.45 页面对象（Page Object）的附加动作字典(aditional-actions dictionary)条目列表

| Key | Type       | Value                                                                                                                  |
| --- | ---------- | ---------------------------------------------------------------------------------------------------------------------- |
| O   | dictionary | （可选; PDF 1.2）打开页面时应执行的一个动作（例如，当用户从下一页或上一页或通过链接注释或大纲项导航到该页面时）。 此操作独立于文档目录中的OpenAction条目可能定义的任何操作，并应在此类操作之后执行。**(Open)** |
| C   | dictionary | （可选; PDF 1.2）页面关闭时应执行的一个动作（例如，当用户导航到下一页或上一页或遵循链接注释或大纲项时）。 此操作适用于正在关闭的页面，并应在打开任何其他页面之前执行。**(Close)**                    |





表 8.46 表单域（Form Field）的附加动作字典 条目

| Key | Type       | Value                                                                                                                     |
| --- | ---------- | ------------------------------------------------------------------------------------------------------------------------- |
| K   | dictionary | （可选; PDF 1.3）当用户修改文本字段或组合框中的字符或修改可滚动列表框中的选择时应执行的JavaScript操作。 此操作可以检查添加的文本的合法性，来决定是否可以修改。**(KeyStroke)**                  |
| F   | dictionary | （可选; PDF 1.3）在格式化字段显示值之前，应执行的JavaScript动作。 此操作可以在格式化之前，先修改字段的值，以影响显示结果。**(Formated)**                                     |
| V   | dictionary | （可选; PDF 1.3）当字段值更改时，应执行的JavaScript动作。 此操作可能会检查新值的有效性。 （名称V代表“Validate”。）                                                 |
| C   | dictionary | （可选; PDF 1.3）当另一个字段的值发生更改时，应执行的JavaScript操作以重新计算此字段的值。 （名称C代表“**Calculate**”。）重新计算文档字段的顺序，应由交互式表d单字典中的CO条目定义（见“交互式表格字典”）。 |
| WC  | dictionary | <p>（可选; PDF 1.4）在关闭文档之前应执行的JavaScript操作。</p><p> （WC名称代表“<strong>Will Close</strong>。”）</p>                                |
| WS  | dictionary | <p>（可选; PDF 1.4）在保存文档之前应执行的JavaScript操作。 </p><p>（名称WS代表“<strong>Will Save。</strong>”）</p>                                 |
| DS  | dictionary | <p>（可选; PDF 1.4）保存文档后应执行的JavaScript操作。 </p><p>（名称DS代表“<strong>Did Save</strong>”）</p>                                     |
| WP  | dictionary | <p>（可选; PDF 1.4）在打印文档之前应执行的JavaScript操作。 </p><p>（WP名称代表“<strong>Will Print</strong>”）</p>                                 |
| DP  | dictionary | <p>（可选; PDF 1.4）打印文档后应执行的JavaScript操作。 </p><p>（名称DP代表“<strong>Did Print</strong>”）</p>                                    |

注意：\
表单域(Form Field)中的按钮，不能定义这些触发事件：K（击键），F（格式），V（验证）和C（计算）。 由这些事件之一触发的动作的效果仅受动作本身的限制，并且可以在所描述的事件范围之外发生。

这些与表单域(form field)相关的触发事件，可以通过用户交互或以编程方式实现：

* 为了响应“交互式表单字典”中的NeedAppearances条目，可以指定FDF数据或JavaScript操作。
* 用户修改字段值可以触发一系列计算，并进一步格式化和验证文档中的其他字段。



表 8.47 文档目录（Document catalog）的附加动作字典 条目

| Key | Type       | Value                                                                         |
| --- | ---------- | ----------------------------------------------------------------------------- |
| WC  | dictionary | <p>(可选;PDF1.4) 在关闭文档之前执行的JavaScript动作。</p><p>(WC这个名字代表“将要关闭 will close”)。</p> |
| WS  | dictionary | <p>(可选;PDF1.4) 在保存文档之前执行的JavaScript动作。</p><p>(WS这个名字代表“将要关闭 will save”)。</p>  |
| DS  | dictionary | (可选;PDF1.4) 保存文档之后执行的JavaScript动作。(DS代表“did save”。)                           |
| WP  | dictionary | <p>(可选;PDF1.4) 在打印文档之前要执行的JavaScript动作。</p><p>(WP这个名字代表“将打印 will print”。)</p> |
| DP  | dictionary | <p>(可选;PDF1.4)打印文档后执行的JavaScript动作。</p><p>(DP代表“已打印 did print”。)</p>          |

对于触发事件E(输入)、X(退出)、D(下)和U(上)，术语鼠标表示具有以下特征的通用指向设备：

*   一个可以按下、按下和释放的选择按钮。如果还有更多的话

    与一个鼠标按钮相比，选择按钮通常是左键。
*   一种位置的概念——也就是说，设备在屏幕上的位置的指示

    指向。位置通常由屏幕光标表示。
*   焦点的概念—即文档中当前与用户交互的元素。在许多系统中，这个元素由一个闪烁的插入符号表示，

    一个焦点矩形，或一个颜色变化。

PDF查看器应用程序必须确保存在这样的设备，以便正确执行相应的操作。鼠标相关的触发事件受以下约束：

* E (enter)事件只能在鼠标按钮打开时发生。
* 没有前面的E事件，X(exit)事件就不能发生。
* 如果没有E和D事件，U (up)事件就不能发生
*   在重叠或嵌套注释的情况下，输入第二个注释的

    活动区域导致第一个注释发生X事件。



注意：\
表单域(Form Field)中的按钮，不能定义这些触发事件：K（击键 keystroke），F（格式 format），V（验证 validate）和C（计算 calculate）(see “Button Fields” on page 685)。 由这些事件之一触发的动作的效果仅受动作本身的限制，并且可以在所描述的事件范围之外发生。例如，虽然F事件用于触发在显示之前格式化字段值的动作，但是由于这个事件执行计算或者对文档的修改可能导致一个动作的触发。

这些与字段相关的触发事件可以通过用户交互或编程方式发生，例如，响应 在交互式表格字典（Interactive Form Dictionary）的NeedAppearance 条目表单字典 (see Section 8.6.1, “Interactive Form Dictionary”)，输入FDF数据(Section 8.6.6, “Forms Data Format”)，或JavaScript动作(“JavaScript(见第709页)。例如，用户修改字段值可以触发其他字段的级联计算和在文档种进一步的格式化和验证。

这些与表单域(Form Field)相关的触发事件，可以通过用户交互或以编程方式实现：

* 为了响应“交互式表单字典”中的NeedAppearances条目，可以指定FDF数据或JavaScript操作。
* 用户修改字段值可以触发一系列计算，并进一步格式化和验证文档中的其他字段。
